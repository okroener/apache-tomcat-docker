version: '3'
services:
  tomcat:
    build: .
    container_name: tomcat_moqui
    restart: always
    links:
      - elasticsearch
    ports:
      - "8443:8443"
    volumes:
      - ./server.xml:/usr/local/tomcat/conf/server.xml
      - ./webapps:/usr/local/tomcat/webapps
      - ./logs:/usr/local/tomcat/logs
    environment:
      - elasticsearch_url=http://elasticsearch:9200
    networks:
      - backend
  
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch-oss:7.10.2
    container_name: elasticsearch_moqui
    restart: always
    volumes:
      - ./elasticsearch/data:/opt/elasticsearch/data
    environment:
      - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"
      - discovery.type=single-node
      - network.host=_site_
    networks:
      - backend
networks:
  backend:
